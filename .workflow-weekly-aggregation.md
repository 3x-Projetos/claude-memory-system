# Workflow: Weekly Aggregation

**Propósito**: Agregar logs diários em resumo semanal para economia de tokens e visão de alto nível.

**Quando executar**:
- Automaticamente ao detectar semana sem registro (via `/continue` ou `/new`)
- Manualmente via `/aggregate week`
- Recomendado: Toda segunda-feira

---

## Input
- **Arquivos**: Todos os logs em `logs/daily/` da semana alvo
- **Período**: 7 dias consecutivos (segunda a domingo)
- **Formato**: `YYYY.MM.DD.md` (exemplo: 2025.11.11.md a 2025.11.17.md)

## Output
- **Arquivo**: `logs/weekly/YYYY.MM.weekN.md`
- **Tamanho alvo**: ~100 linhas (vs ~700 linhas em 7 dias de logs diários)
- **Redução esperada**: ~85%

---

## Processo

### 1. Identificação da Semana
- Calcular número da semana ISO (semana 1 = primeira com quinta-feira do ano)
- Validar que todos os 7 dias têm logs
- Se faltar dias: incluir nota no resumo

### 2. Leitura dos Logs Diários
- Ler todos os arquivos `logs/daily/YYYY.MM.DD.md` da semana
- Extrair blocos `[session-log]` de cada dia
- Ignorar blocos `[raw]` e `[prompt]` (são notas pessoais)

### 3. Análise e Agregação
Claude deve agregar as seguintes seções:

#### a) Projetos Ativos (alto nível)
- Listar projetos trabalhados na semana
- Status de cada projeto (iniciado/em andamento/completo/pausado)
- Milestone alcançados

#### b) Arquivos Principais
- Top 10-15 arquivos mais mencionados/modificados
- Agrupados por categoria se possível

#### c) Atividades por Categoria
**Desenvolvimento**:
- Features implementadas
- Bugs corrigidos
- Refactorings

**Documentação**:
- Docs criados/atualizados
- README, guias, etc

**Infraestrutura**:
- Configurações, CI/CD, deployment
- Ferramentas instaladas/configuradas

**Aprendizados**:
- Tecnologias/frameworks aprendidos
- Problemas resolvidos (com soluções)

**Decisões Arquiteturais**:
- Decisões importantes tomadas
- Trade-offs considerados

#### d) Métricas da Semana (se disponíveis)
- Sessões Claude CLI: X
- Commits Git: Y
- Arquivos modificados: Z
- Horas estimadas: W

**Métricas Holísticas** (baseado em METRICS-FRAMEWORK.md):
- Performance: Velocity, outputs
- Cognitive Load: Complexidade das tarefas
- Well-being: Satisfação geral (se registrado via /reflect)
- Learning: Novas habilidades adquiridas
- Autonomy: Tarefas complexas realizadas sozinho vs com ajuda

#### e) Próximos Passos
- Tarefas pendentes priorizadas
- Blockers identificados
- Planos para próxima semana

### 4. Formatação do Resumo
```markdown
# Resumo Semanal - YYYY.MM (Semana N)
**Período**: DD/MM/YYYY - DD/MM/YYYY
**Dias com logs**: 7/7 (ou X/7 se incompleto)

---

## Projetos Ativos
1. [Nome do Projeto] - [Status]
   - [Milestone alcançado]
   - [Milestone alcançado]

---

## Atividades por Categoria

### Desenvolvimento
- [Feature X implementada]
- [Bug Y corrigido]

### Documentação
- [Doc criado/atualizado]

### Infraestrutura
- [Configuração Z]

### Aprendizados
- [Tecnologia aprendida]
- [Problema resolvido]: Solução

### Decisões Arquiteturais
- [Decisão tomada]: Motivo

---

## Arquivos Principais
1. path/to/file1.ext (modificado 5x)
2. path/to/file2.ext (criado)
...

---

## Métricas da Semana
- Sessões: X
- Commits: Y
- Arquivos: Z
- Horas: ~W

**Holísticas**:
- Performance: [descrição]
- Cognitive Load: [descrição]
- Well-being: [descrição]
- Learning: [descrição]
- Autonomy: [descrição]

---

## Próximos Passos
- [ ] Tarefa prioritária 1
- [ ] Tarefa prioritária 2
- [ ] Blocker: [descrição]

---

*Resumo gerado automaticamente a partir de logs diários*
```

---

## Execução via Comando

**Uso**:
```
/aggregate week [YYYY] [week_number]
```

**Exemplos**:
- `/aggregate week` → Agrega última semana completa
- `/aggregate week 2025 46` → Agrega semana 46 de 2025

**Comando instrui Claude**:
1. Identificar semana alvo
2. Ler todos os logs diários da semana
3. Executar este workflow
4. Criar arquivo `logs/weekly/YYYY.MM.weekN.md`
5. Atualizar `.session-state.md` (marcar semana como agregada)

---

## Validação

**Checklist pós-agregação**:
- [ ] Arquivo criado em `logs/weekly/`
- [ ] Tamanho ~100 linhas (85% menor que input)
- [ ] Nenhuma informação crítica perdida
- [ ] Métricas calculadas corretamente
- [ ] Próximos passos capturam pendências reais

---

## Notas Importantes

- **Não é um sumário verbatim**: Agregação inteligente, não copiar/colar
- **Preservar contexto crítico**: Decisões arquiteturais, blockers, aprendizados
- **Descartar detalhes transientes**: Comandos específicos, outputs verbosos
- **Foco em tendências**: O que foi feito repetidamente, padrões emergentes

---

*Este workflow é parte do Sistema de Memória Hierárquica - Economia de tokens: ~85% por semana*
